<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>SMART on FHIR Scheduling App Tutorial</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #75715e;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #f8f8f2;
}
.highlight .p, .highlight .pi {
  color: #f8f8f2;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #ae81ff;
}
.highlight .kc {
  color: #fd971f;
}
.highlight .kt {
  color: #fd971f;
}
.highlight .kd {
  color: #fd971f;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #a6e22e;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #a6e22e;
}
.highlight .ss {
  color: #a6e22e;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;code&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="code">code</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>This tutorial will walk you through creating an app in Cerner&rsquo;s SMART on FHIR ecosystem. In particular, your app will focus on FHIR scheduling workflows.</p>

<p>After completing this tutorial you will know how to:</p>

<ul>
<li>Create a basic SMART on FHIR app that interacts with scheduling resources.</li>
<li>Self register an app with Cerner.</li>
<li>Run an app in Cerner&rsquo;s SMART on FHIR sandbox.</li>
</ul>

<h1 id="prerequisites">Prerequisites</h1>

<ul>
<li>A public <a href="http://www.github.com">GitHub</a> account</li>
</ul>

<h1 id="project-setup">Project Setup</h1>

<p>First, you&rsquo;ll want to fork this tutorial from <a href="https://github.com/MaxPhilips/smart-on-fhir-scheduling-tutorial">smart-on-fhir-scheduling-tutorial</a> to your GitHub account.</p>

<p>The <code class="prettyprint">smart-on-fhir-scheduling-tutorial/source/scheduling-app</code> folder contains the example SMART app which you&rsquo;ll be using throughout this tutorial. Let&rsquo;s take a look at some of the notable files contained within:</p>

<p><strong>fhir-client-v0.1.12.js</strong></p>

<p>Located in the lib/js folder, this is a version of <a href="https://github.com/smart-on-fhir/client-js"><code class="prettyprint">fhir-client.js</code></a> which is an open source library designed to assist with calling a FHIR API and handling the SMART on FHIR authorization workflow. This tutorial uses this library when walking you through building your first SMART app.</p>

<p>Additional documentation on <code class="prettyprint">fhir-client.js</code> can be found <a href="http://docs.smarthealthit.org/clients/javascript/">here</a>.</p>

<aside class="notice">
This tutorial is designed to have a minimal footprint so we made the decision to directly include `fhir-client.js` for simplicity. For your production applications we&rsquo;d recommend pulling in `fhir-client.js` using npm or some other package manager to easily keep your application up to date.
</aside>

<p><strong>launch.html</strong></p>

<p>launch.html is the SMART app&rsquo;s initial entry point and in a real production environment, would be invoked by the application launching your SMART app (for instance, the EHR or patient portal). In the <a href="http://docs.smarthealthit.org/">SMART documentation</a>, this is your app&rsquo;s &ldquo;launch URL&rdquo;. In this tutorial, this page will be invoked when you launch your app from Cerner&rsquo;s <a href="https://code.cerner.com/developer/smart-on-fhir/apps">code console</a>.</p>

<p>As the entry point into your SMART app, this page will kick-off the SMART authorization workflow.</p>

<p><strong>index.html</strong></p>

<p>This page will be invoked via redirect from the Authorization server at the conclusion of the SMART authorization workflow. When this page is invoked, your SMART app will have everything it needs to run and access the FHIR API.</p>

<p>The other content you see in the source folder is the site for this tutorial. We used <a href="https://github.com/lord/slate">Slate</a> to create the documentation for this tutorial.</p>

<h1 id="1-trigger-a-github-pages-deployment">1.) Trigger a GitHub Pages Deployment</h1>

<blockquote>
<p>/scheduling-app/index.html</p>
</blockquote>
<div class="highlight"><pre class="highlight html"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">'en'</span> <span class="na">hidden</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>

...

  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'container'</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
-&gt;        <span class="nt">&lt;h1&gt;</span>travistcummings Scheduling App<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

...
</code></pre></div>
<blockquote>
<p>Go to your GitHub account, select the Repositories tab and select the smart-on-fhir-scheduling-tutorial repository. Select the Branch button and switch to the gh-pages branch. Directly edit <code class="prettyprint">/scheduling-app/index.html</code> by clicking on the pencil icon. Once you&rsquo;ve made the change, commit directly to the gh-pages branch.</p>
</blockquote>

<p>For the purposes of this tutorial we will be hosting our SMART app through <a href="https://help.github.com/articles/what-is-github-pages">GitHub Pages</a>. GitHub Pages is a convenient way to host static or client rendered web sites.</p>

<p>Setting up GitHub pages is easy, so easy in fact that it&rsquo;s already done for you. GitHub pages works by hosting content from a repository branch named &ldquo;gh-pages&rdquo;. Since you forked the tutorial, the gh-pages branch has already been created, however, GitHub won&rsquo;t publish your site until you make a change to that branch, so let&rsquo;s make a change. Modify the index.html page to include your GitHub username in the app&rsquo;s title, and commit directly to the gh-pages branch.</p>

<p>Use the GitHub UI to directly edit <code class="prettyprint">index.html</code>. Simply switch the branch to gh-pages, navigate to <code class="prettyprint">/scheduling-app/index.html</code> and click the pencil icon. Commit your changes to deploy.</p>

<p>Once the app has been deployed go to <code class="prettyprint">https://&lt;github username&gt;.github.io/smart-on-fhir-scheduling-tutorial/scheduling-app/health</code> to ensure your app is available.</p>

<aside class="notice">
GitHub Pages sites have a limit of 10 builds per hour, so if your page isn&rsquo;t updating, this could be the reason.
</aside>

<h1 id="2-register-your-app-with-cerner">2.) Register Your App with Cerner</h1>

<p>Now that we have deployed a SMART app, let&rsquo;s register it to access Cerner&rsquo;s FHIR resources. Cerner has created a self-registration console to allow developers to run SMART apps in a sandbox environment. Navigate to Cerner&rsquo;s <a href="https://code.cerner.com/developer/smart-on-fhir/apps">code console</a>. If you don&rsquo;t have a Cerner Care Account, go ahead and sign up for one (it&rsquo;s free!). Once logged into the console, click on the &ldquo;+ New App&rdquo; button in the top right toolbar and fill in the following details:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>App Name</td>
<td>Cool App</td>
<td>Any name your heart desires.</td>
</tr>
<tr>
<td>SMART Launch URI</td>
<td><code class="prettyprint">https://&lt;github username&gt;.github.io/smart-on-fhir-scheduling-tutorial/scheduling-app/launch.html</code></td>
<td>The page that launches your app.</td>
</tr>
<tr>
<td>Redirect URI</td>
<td><code class="prettyprint">https://&lt;github username&gt;.github.io/smart-on-fhir-scheduling-tutorial/scheduling-app/</code></td>
<td>The main logic for your app.</td>
</tr>
<tr>
<td>App Type</td>
<td>Provider</td>
<td>You are creating a provider-facing facing app.</td>
</tr>
<tr>
<td>FHIR Spec</td>
<td>dstu2</td>
<td>Your app will run against Cerner&rsquo;s implementation of the DSTU 2 FHIR specification.</td>
</tr>
<tr>
<td>Authorized</td>
<td>Yes</td>
<td>Authorized apps will go through secured OAuth 2 login.</td>
</tr>
<tr>
<td>Standard Scopes</td>
<td>online_access</td>
<td>The already-checked standard scopes are required to launch your SMART app. Offline access is for system-facing apps, so we need online access.</td>
</tr>
<tr>
<td>User Scopes</td>
<td>Appointment write, Patient read, Patient write, and Slot read</td>
<td>Your app needs to be able to write appointments, read and write patients, and read slots.</td>
</tr>
<tr>
<td>Patient Scopes</td>
<td>None</td>
<td>Your app does not need any patient scopes.</td>
</tr>
</tbody></table>

<p>Click &ldquo;Register&rdquo; to complete the process. This will add the app to your account and create a client id for app authorization.</p>

<p>The new OAuth 2 client id for your app will be displayed in a banner at the top of the page and can be viewed at any time by clicking on the application icon to view more details.</p>

<aside class="notice">
After initially registering your SMART app, it can take up to 10 minutes for your app details to propogate throughout our sandbox. So, please wait 10 minutes before trying to launch your app - you can continue working through this tutorial in the mean time.
</aside>

<h1 id="3-request-authorization">3.) Request Authorization</h1>

<blockquote>
<p>/scheduling-app/launch.html</p>
</blockquote>
<div class="highlight"><pre class="highlight html"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">'en'</span> <span class="na">hidden</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>

...

  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>

...

    <span class="nt">&lt;script&gt;</span>
      <span class="nx">FHIR</span><span class="p">.</span><span class="nx">oauth2</span><span class="p">.</span><span class="nx">authorize</span><span class="p">({</span>
<span class="o">-&gt;</span>      <span class="s1">'client_id'</span><span class="p">:</span> <span class="s1">'[CLIENT ID]'</span><span class="p">,</span>
        <span class="s1">'scope'</span><span class="p">:</span> <span class="s1">'user/Appointment.write user/Patient.read user/Patient.write user/Slot.read launch online_access openid profile'</span>
      <span class="p">});</span>
    <span class="nt">&lt;/script&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'spinner'</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'bounce1'</span><span class="nt">&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'bounce2'</span><span class="nt">&gt;&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'bounce3'</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>
<blockquote>
<p>Make sure to use the client id generated by the code console for your <code class="prettyprint">FHIR.oauth2.authorize</code> call and redeploy your site.</p>
</blockquote>

<p>The responsibility of <code class="prettyprint">launch.html</code> is to redirect to the appropriate FHIR authorization server. As you can see in the code, <code class="prettyprint">fhir-client.js</code> makes our job pretty easy. All we have to do is call <code class="prettyprint">FHIR.oauth2.authorize</code> supplying the client id generated by Cerner&rsquo;s code console during registration and the scopes we registered.</p>

<p>Your app&rsquo;s client id is found on the app details page that can be accessed by clicking on the application icon in the <a href="https://code.cerner.com/developer/smart-on-fhir/apps">code console</a>. Copy the client id into the authorize call in <code class="prettyprint">launch.html</code>, commit the changes back to your repo and redeploy your site.</p>

<p>For the purposes of this tutorial you don&rsquo;t need to modify the OAuth 2 scopes. This list should match the scopes that you registered the application with.</p>

<p>Please refer to Cerner&rsquo;s <a href="https://engineering.cerner.com/smart-on-fhir-tutorial/#request-authorization">base SMART on FHIR tutorial</a> for more information on request authorization.</p>

<h1 id="4-how-the-app-works">4.) How the App Works</h1>

<h2 id="requesting-access-to-fhir-resources">Requesting Access to FHIR Resources</h2>

<blockquote>
<p>/scheduling-app/src/js/scheduling-app.js</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript"><code><span class="p">...</span>

  <span class="nx">FHIR</span><span class="p">.</span><span class="nx">oauth2</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">smart</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Query the FHIR server for Slots</span>
    <span class="nx">smart</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">fetchAll</span><span class="p">({</span><span class="na">type</span><span class="p">:</span> <span class="s1">'Slot'</span><span class="p">,</span> <span class="na">query</span><span class="p">:</span> <span class="nx">slotParams</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span>

      <span class="c1">// Display Appointment information if the call succeeded</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">slots</span><span class="p">)</span> <span class="p">{</span>

<span class="p">...</span>

      <span class="p">},</span>

      <span class="c1">// Display 'Failed to read Slots from FHIR server' if the call failed</span>
      <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

<span class="p">...</span>

      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">});</span>

<span class="p">...</span>
</code></pre></div>
<blockquote>
<p>No code changes are required for this step.</p>
</blockquote>

<p>Now that the app has successfully been authenticated, it&rsquo;s time to call a FHIR resource, but first we need to obtain an OAuth2 access token. We have an authorization code that was passed as a query param to the redirect URI (<code class="prettyprint">index.html</code>) by the authorization server. The authorization code is exchanged for an access token through POST to the authorization server. Again, <code class="prettyprint">fhir-client.js</code> makes this easy for us.</p>

<p>The <code class="prettyprint">scheduling-app.js</code> file registers a form on submit event which uses the <code class="prettyprint">FHIR.oauth2.ready()</code> function to exchange the authorization code for the access token and stores it in session storage for later use.</p>

<h2 id="accessing-fhir-resources">Accessing FHIR Resources</h2>

<blockquote>
<p>/scheduling-app/src/js/scheduling-app.js - onReady</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript"><code><span class="p">...</span>

    <span class="nx">FHIR</span><span class="p">.</span><span class="nx">oauth2</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">smart</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Query the FHIR server for Slots</span>
    <span class="nx">smart</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">fetchAll</span><span class="p">({</span><span class="na">type</span><span class="p">:</span> <span class="s1">'Slot'</span><span class="p">,</span> <span class="na">query</span><span class="p">:</span> <span class="nx">slotParams</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span>

      <span class="c1">// Display Appointment information if the call succeeded</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">slots</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// If any Slots matched the criteria, display them</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">slots</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">slotsHTML</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

          <span class="nx">slots</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">slot</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">slotsHTML</span> <span class="o">=</span> <span class="nx">slotsHTML</span> <span class="o">+</span> <span class="nx">slotHTML</span><span class="p">(</span><span class="nx">slot</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">slot</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">text</span><span class="p">,</span> <span class="nx">slot</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span> <span class="nx">slot</span><span class="p">.</span><span class="nx">end</span><span class="p">);</span>
          <span class="p">});</span>

          <span class="nx">renderSlots</span><span class="p">(</span><span class="nx">slotsHTML</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// If no Slots matched the criteria, inform the user</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">renderSlots</span><span class="p">(</span><span class="s1">'&lt;p&gt;No Slots found for the selected query parameters.&lt;/p&gt;'</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="c1">// Display 'Failed to read Slots from FHIR server' if the call failed</span>
      <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">clearUI</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#errors'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;p&gt;Failed to read Slots from FHIR server&lt;/p&gt;'</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#errors-row'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">});</span>

<span class="p">...</span>
</code></pre></div>
<blockquote>
<p>No code changes are required for this step.</p>
</blockquote>

<p>With access token in hand we&rsquo;re ready to request a FHIR resource and again, we will be using <code class="prettyprint">fhir-client.js</code>.</p>

<p>For the purposes of this tutorial we&rsquo;ll be retrieving information that allows the user to book appointments.</p>

<p>The <code class="prettyprint">fhir-client.js</code> library defines a useful function we can use to retrieve this information: <code class="prettyprint">smart.api.fetchAll()</code>. This uses the <a href="https://github.com/FHIR/fhir.js">fhir.js</a> API to retrieve resources and returns a JavaScript promise. We then set up functions to handle success and failure cases.</p>

<p>On a success, we&rsquo;re taking the response from the FHIR server and building HTML strings to display to our users.</p>

<p>The <code class="prettyprint">fhir-client.js</code> library defines several more APIs that will come in handy while developing smart app. Read about them <a href="http://docs.smarthealthit.org/clients/javascript/">here</a>.</p>

<h2 id="displaying-fhir-resources">Displaying FHIR Resources</h2>

<blockquote>
<p>/scheduling-app/index.html</p>
</blockquote>
<div class="highlight"><pre class="highlight html"><code>...

      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'slots-holder-row'</span> <span class="na">class=</span><span class="s">'row mt-5'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'slots-holder'</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h2&gt;</span>Slots<span class="nt">&lt;/h2&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
                <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">'btn btn-danger'</span> <span class="na">id=</span><span class="s">'clear-slots'</span><span class="nt">&gt;</span>Clear Results<span class="nt">&lt;/button&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'slots'</span><span class="nt">&gt;&lt;/div&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

...
</code></pre></div>
<blockquote>
<p>scheduling-app.js - renderSlots</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript"><code><span class="p">...</span>

<span class="kd">function</span> <span class="nx">renderSlots</span><span class="p">(</span><span class="nx">slotsHTML</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">clearUI</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#slots'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">slotsHTML</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#slots-holder-row'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>
<blockquote>
<p>No code changes are required for this step.</p>
</blockquote>

<p>The last remaining task for our application is displaying the resource information we&rsquo;ve retrieved. In <code class="prettyprint">index.html</code> we define a hidden div element to hold Slot information. On a successful FHIR server call we&rsquo;ll invoke <code class="prettyprint">renderSlots</code> which will show the div as well as update its HTML to display Slots.</p>

<h1 id="5-test-your-app">5.) Test your App</h1>

<blockquote>
<p>Any time you need to redeploy your app via GitHub Pages, commit changes to your gh-pages branch.</p>
</blockquote>

<p>Now that we have a snazzy SMART app, it&rsquo;s time to test it.</p>

<p>Return to the <a href="https://code.cerner.com/developer/smart-on-fhir/apps">code console</a> and click on the app you registered earlier. To launch your app through the code console click the &ldquo;Begin Testing&rdquo; button. The console will ask if the app you&rsquo;re launching requires a patient in context - your app does not, so select &ldquo;No&rdquo; then &ldquo;Next&rdquo;. Please note the Millennium username and password displayed in the launch dialog, you&rsquo;ll need those credentials to log in and authorize your app. Finally, click &ldquo;Launch&rdquo; and the console will redirect to your application.</p>

<p>Log in with the credentials you received (you&rsquo;ll only need to do this once per browser session) and play with your app!</p>

<aside class="notice">
You will find that this application is preloaded with Practitioners, Locations, and Slot types to search by. In a production scenario, you would need to work with Cerner to gather this information before deploying your app to a client site.
</aside>

<p>In particular, some limitations to be aware of are:</p>

<ul>
<li>Cerner&rsquo;s implementation of the Practitioner resource only allows search by id, so you need to know Practitioners ahead of time to use them in your app.</li>
<li>Slot types can use standard (LOINC, SNOMED, etc.) or proprietary codes. A single standard code may represent multiple proprietary codes, e.g. a standard code for Office Visit may correspond to multiple proprietary codes like Office Visit Doctor A and Office Visit Doctor B.</li>
<li>Cerner&rsquo;s FHIR server does not implement the ValueSet resource, so again, you need to know Slot types ahead of time to use them in your app.</li>
<li>Cerner&rsquo;s FHIR server does not implement the Location resource, so finally, you need to know Locations ahead of time to use them in your app.</li>
</ul>

<p>Cerner will work with you before a go-live to ensure you have all the information for your app to succeed!</p>

<aside class="notice">
You may have noticed a date range search is included in the Slot query. It is strongly recommended to use as small of a date range as you are able to - scheduling data involves a ton of database rows.
</aside>

<p>One Practitioner may have sixteen half-hour slots on a given day. Multiply that number by each Slot type and Location they are available at. Then multiply that by the number of Practitioners a practice may contain. Even for a small office of five Practitioners with only a handful of Slot types, there could be as many as 1,600 Slots for one week. For larger offices, it is entirely possible to see numbers like ten million Slots per month! That will take a long time for your app to request.</p>

<h1 id="6-add-appointment-booking">6.) Add Appointment Booking</h1>

<blockquote>
<p>/scheduling-app/index.html</p>
</blockquote>
<div class="highlight"><pre class="highlight html"><code>...

      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'appointment-holder-row'</span> <span class="na">class=</span><span class="s">'row mt-5'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'appointment-holder'</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h2&gt;</span>Appointment<span class="nt">&lt;/h2&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
                <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">'btn btn-danger'</span> <span class="na">id=</span><span class="s">'clear-appointment'</span><span class="nt">&gt;</span>Clear Results<span class="nt">&lt;/button&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'appointment'</span><span class="nt">&gt;&lt;/div&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

...
</code></pre></div>
<blockquote>
<p>Add this HTML to <code class="prettyprint">index.html</code> immediately after the slots-holder-row div. Should be on line 118 if you haven&rsquo;t tweaked the file much.</p>

<p>/scheduling-app/src/js/scheduling-app.js - slotHTML</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript"><code><span class="p">...</span>

<span class="kd">function</span> <span class="nx">slotHTML</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Slot: id:['</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">'] type:['</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s1">'] start:['</span> <span class="o">+</span> <span class="nx">start</span> <span class="o">+</span> <span class="s1">'] end:['</span> <span class="o">+</span> <span class="nx">end</span> <span class="o">+</span> <span class="s1">']'</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">slotReference</span> <span class="o">=</span> <span class="s1">'Slot/'</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span>
      <span class="nx">prettyStart</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">start</span><span class="p">),</span>
      <span class="nx">prettyEnd</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">end</span><span class="p">);</span>

  <span class="k">return</span> <span class="s2">"&lt;div class='card'&gt;"</span> <span class="o">+</span>
           <span class="s2">"&lt;div class='card-body'&gt;"</span> <span class="o">+</span>
             <span class="s2">"&lt;h5 class='card-title'&gt;"</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s1">'&lt;/h5&gt;'</span> <span class="o">+</span>
             <span class="s2">"&lt;p class='card-text'&gt;Start: "</span> <span class="o">+</span> <span class="nx">prettyStart</span> <span class="o">+</span> <span class="s1">'&lt;/p&gt;'</span> <span class="o">+</span>
             <span class="s2">"&lt;p class='card-text'&gt;End: "</span> <span class="o">+</span> <span class="nx">prettyEnd</span> <span class="o">+</span> <span class="s1">'&lt;/p&gt;'</span> <span class="o">+</span>
             <span class="s2">"&lt;a href='javascript:void(0);' class='card-link' onclick='appointmentCreate(</span><span class="se">\"</span><span class="s2">"</span> <span class="o">+</span>
               <span class="nx">slotReference</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">Patient/4704007</span><span class="se">\"</span><span class="s2">);'&gt;Book&lt;/a&gt;"</span> <span class="o">+</span>
           <span class="s1">'&lt;/div&gt;'</span> <span class="o">+</span>
         <span class="s1">'&lt;/div&gt;'</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>
<blockquote>
<p>Replace the slotHTML JavaScript function with this JavaScript. Should be on line 58.</p>

<p>/scheduling-app/src/js/scheduling-app.js</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript"><code><span class="p">...</span>

<span class="nx">$</span><span class="p">(</span><span class="s1">'#clear-appointment'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#appointment'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#appointment-holder-row'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">appointmentCreate</span><span class="p">(</span><span class="nx">slotReference</span><span class="p">,</span> <span class="nx">patientReference</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">clearUI</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#loading-row'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>

  <span class="kd">var</span> <span class="nx">appointmentBody</span> <span class="o">=</span> <span class="nx">appointmentJSON</span><span class="p">(</span><span class="nx">slotReference</span><span class="p">,</span> <span class="nx">patientReference</span><span class="p">);</span>

  <span class="c1">// FHIR.oauth2.ready handles refreshing access tokens</span>
  <span class="nx">FHIR</span><span class="p">.</span><span class="nx">oauth2</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">smart</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">smart</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="na">resource</span><span class="p">:</span> <span class="nx">appointmentBody</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span>

      <span class="c1">// Display Appointment information if the call succeeded</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">appointment</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">renderAppointment</span><span class="p">(</span><span class="nx">appointment</span><span class="p">.</span><span class="nx">headers</span><span class="p">(</span><span class="s1">'Location'</span><span class="p">));</span>
      <span class="p">},</span>

      <span class="c1">// Display 'Failed to write Appointment to FHIR server' if the call failed</span>
      <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">clearUI</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#errors'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;p&gt;Failed to write Appointment to FHIR server&lt;/p&gt;'</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#errors-row'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">appointmentJSON</span><span class="p">(</span><span class="nx">slotReference</span><span class="p">,</span> <span class="nx">patientReference</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">resourceType</span><span class="p">:</span> <span class="s1">'Appointment'</span><span class="p">,</span>
    <span class="na">slot</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">reference</span><span class="p">:</span> <span class="nx">slotReference</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="na">participant</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">actor</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">reference</span><span class="p">:</span> <span class="nx">patientReference</span>
        <span class="p">},</span>
        <span class="na">status</span><span class="p">:</span> <span class="s1">'needs-action'</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="na">status</span><span class="p">:</span> <span class="s1">'proposed'</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">renderAppointment</span><span class="p">(</span><span class="nx">appointmentLocation</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">clearUI</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#appointment'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;p&gt;Created Appointment '</span> <span class="o">+</span> <span class="nx">appointmentLocation</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/</span><span class="se">\d</span><span class="sr">+$/</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'&lt;/p&gt;'</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#appointment-holder-row'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<p>Add this JavaScript to the bottom of <code class="prettyprint">scheduling-app.js</code>.</p>
</blockquote>

<p>Now that we&rsquo;ve tested searching for Slots, let&rsquo;s use the Slots to book Appointments. Make the changes noted on the sidebar in <code class="prettyprint">index.html</code> and <code class="prettyprint">scheduling-app.js</code>.</p>

<p>After making these changes, your app will be able to book Appointments for a common test Patient: Barney R Smart, patient id 4704007. Launch your app and test it out!</p>

<p>With many other consumers booking appointments for this patient, it&rsquo;s pretty likely that you will get some failures when you test. When we are searching for Slots, we are not searching by patient so if you attempt to book an Appointment for that patient when they are already unavailable, you will get an error from Cerner&rsquo;s FHIR server. Let&rsquo;s reduce some of these collisions by spreading the load to other patients.</p>

<h1 id="7-add-patient-search-and-create">7.) Add Patient Search and Create</h1>

<blockquote>
<p>/scheduling-app/index.html</p>
</blockquote>
<div class="highlight"><pre class="highlight html"><code>...

      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'patient-search-create-row'</span> <span class="na">class=</span><span class="s">'row mt-5'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'patient-search-create-info'</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;/div&gt;</span>

          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'accordion'</span> <span class="na">id=</span><span class="s">'patient-search-create-accordion'</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'card'</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'card-header'</span> <span class="na">id=</span><span class="s">'headingOne'</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">'mb-0'</span><span class="nt">&gt;</span>
                      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">'btn btn-link'</span> <span class="na">type=</span><span class="s">'button'</span> <span class="na">data-toggle=</span><span class="s">'collapse'</span> <span class="na">data-target=</span><span class="s">'#collapseOne'</span> <span class="na">aria-expanded=</span><span class="s">'true'</span> <span class="na">ria-controls=</span><span class="s">'collapseOne'</span><span class="nt">&gt;</span>
                        Search for existing Patient
                      <span class="nt">&lt;/button&gt;</span>
                    <span class="nt">&lt;/h5&gt;</span>
                  <span class="nt">&lt;/div&gt;</span>
                  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'collapseOne'</span> <span class="na">class=</span><span class="s">'collapse show'</span> <span class="na">aria-labelledby=</span><span class="s">'headingOne'</span> <span class="na">data-parent=</span><span class="s">'#patient-search-create-accordion'</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'card-body'</span><span class="nt">&gt;</span>
                      <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">'patient-search-form'</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'form-group row'</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">'patient-search-name'</span> <span class="na">class=</span><span class="s">'col-sm-2 col-form-label'</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/label&gt;</span>
                          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col-sm-10'</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'text'</span> <span class="na">class=</span><span class="s">'form-control'</span> <span class="na">id=</span><span class="s">'patient-search-name'</span> <span class="na">placeholder=</span><span class="s">'Name'</span> <span class="na">required</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">'btn btn-primary'</span> <span class="na">id=</span><span class="s">'patient-search'</span><span class="nt">&gt;</span>Search for Patients<span class="nt">&lt;/button&gt;</span>
                      <span class="nt">&lt;/form&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                  <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>

                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'card'</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'card-header'</span> <span class="na">id=</span><span class="s">'headingTwo'</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">'mb-0'</span><span class="nt">&gt;</span>
                      <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">'btn btn-link collapsed'</span> <span class="na">type=</span><span class="s">'button'</span> <span class="na">data-toggle=</span><span class="s">'collapse'</span> <span class="na">data-target=</span><span class="s">'#collapseTwo'</span> <span class="na">ria-expanded=</span><span class="s">'false'</span> <span class="na">aria-controls=</span><span class="s">'collapseTwo'</span><span class="nt">&gt;</span>
                        Create new Patient
                      <span class="nt">&lt;/button&gt;</span>
                    <span class="nt">&lt;/h5&gt;</span>
                  <span class="nt">&lt;/div&gt;</span>
                  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'collapseTwo'</span> <span class="na">class=</span><span class="s">'collapse'</span> <span class="na">aria-labelledby=</span><span class="s">'headingTwo'</span> <span class="na">data-parent=</span><span class="s">'#patient-search-create-accordion'</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'card-body'</span><span class="nt">&gt;</span>
                      <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">'patient-create-form'</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'form-group row'</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">'patient-create-firstname'</span> <span class="na">class=</span><span class="s">'col-sm-2 col-form-label'</span><span class="nt">&gt;</span>First Name<span class="nt">&lt;/label&gt;</span>
                          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col-sm-10'</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">'form-control'</span> <span class="na">type=</span><span class="s">'text'</span> <span class="na">name=</span><span class="s">'patient-create-firstname'</span> <span class="na">placeholder=</span><span class="s">'First name'</span> <span class="na">required</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'form-group row'</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">'patient-create-middlename'</span> <span class="na">class=</span><span class="s">'col-sm-2 col-form-label'</span><span class="nt">&gt;</span>Middle Name<span class="nt">&lt;/label&gt;</span>
                          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col-sm-10'</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">'form-control'</span> <span class="na">type=</span><span class="s">'text'</span> <span class="na">name=</span><span class="s">'patient-create-middlename'</span> <span class="na">placeholder=</span><span class="s">'Middle name'</span> <span class="na">required</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'form-group row'</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">'patient-create-lastname'</span> <span class="na">class=</span><span class="s">'col-sm-2 col-form-label'</span><span class="nt">&gt;</span>Last Name<span class="nt">&lt;/label&gt;</span>
                          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col-sm-10'</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">'form-control'</span> <span class="na">type=</span><span class="s">'text'</span> <span class="na">name=</span><span class="s">'patient-create-lastname'</span> <span class="na">placeholder=</span><span class="s">'Last name'</span> <span class="na">required</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'form-group row'</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">'patient-create-phone'</span> <span class="na">class=</span><span class="s">'col-sm-2 col-form-label'</span><span class="nt">&gt;</span>Phone Number<span class="nt">&lt;/label&gt;</span>
                          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col-sm-10'</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">'form-control'</span> <span class="na">type=</span><span class="s">'tel'</span> <span class="na">name=</span><span class="s">'patient-create-phone'</span> <span class="na">placeholder=</span><span class="s">'555-555-5555'</span> <span class="na">attern=</span><span class="s">'[0-9]{3}-[0-9]{3}-[0-9]{4}'</span> <span class="na">required</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;fieldset</span> <span class="na">class=</span><span class="s">'form-group'</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;legend</span> <span class="na">class=</span><span class="s">'col-form-label col-sm-2 pt-0'</span><span class="nt">&gt;</span>Gender<span class="nt">&lt;/legend&gt;</span>
                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col-sm-10'</span><span class="nt">&gt;</span>
                              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'form-check'</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">'form-check-input'</span> <span class="na">type=</span><span class="s">'radio'</span> <span class="na">name=</span><span class="s">'gridRadios'</span> <span class="na">id=</span><span class="s">'patient-create-male'</span> <span class="na">value=</span><span class="s">'male'</span> <span class="na">checked</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">'form-check-label'</span> <span class="na">for=</span><span class="s">'patient-create-male'</span><span class="nt">&gt;</span>
                                  Male
                                <span class="nt">&lt;/label&gt;</span>
                              <span class="nt">&lt;/div&gt;</span>
                              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'form-check'</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">'form-check-input'</span> <span class="na">type=</span><span class="s">'radio'</span> <span class="na">name=</span><span class="s">'gridRadios'</span> <span class="na">id=</span><span class="s">'patient-create-female'</span> <span class="na">value=</span><span class="s">'female'</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">'form-check-label'</span> <span class="na">for=</span><span class="s">'patient-create-female'</span><span class="nt">&gt;</span>
                                  Female
                                <span class="nt">&lt;/label&gt;</span>
                              <span class="nt">&lt;/div&gt;</span>
                            <span class="nt">&lt;/div&gt;</span>
                          <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/fieldset&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'form-group row'</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">'patient-create-birthdate'</span> <span class="na">class=</span><span class="s">'col-sm-2 col-form-label'</span><span class="nt">&gt;</span>Birthdate<span class="nt">&lt;/label&gt;</span>
                          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col-sm-10'</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">'form-control'</span> <span class="na">type=</span><span class="s">'date'</span> <span class="na">name=</span><span class="s">'patient-create-birthdate'</span> <span class="na">required</span><span class="nt">&gt;</span>
                          <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">'btn btn-primary'</span> <span class="na">id=</span><span class="s">'patient-create'</span><span class="nt">&gt;</span>Create Patient<span class="nt">&lt;/button&gt;</span>
                      <span class="nt">&lt;/form&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                  <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;/div&gt;</span>

          <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'patient-errors-row'</span> <span class="na">class=</span><span class="s">'row mt-5'</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'patient-errors'</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;/div&gt;</span>

          <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'patient-loading-row'</span> <span class="na">class=</span><span class="s">'row mt-5'</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'loading'</span> <span class="na">class=</span><span class="s">'spinner'</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'bounce1'</span><span class="nt">&gt;&lt;/div&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'bounce2'</span><span class="nt">&gt;&lt;/div&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'bounce3'</span><span class="nt">&gt;&lt;/div&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;/div&gt;</span>

          <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'patients-holder-row'</span> <span class="na">class=</span><span class="s">'row mt-5'</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'patients-holder'</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;h2&gt;</span>Patients<span class="nt">&lt;/h2&gt;</span>
                  <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">'btn btn-danger'</span> <span class="na">id=</span><span class="s">'clear-patients'</span><span class="nt">&gt;</span>Clear Results<span class="nt">&lt;/button&gt;</span>
                  <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'row'</span><span class="nt">&gt;</span>
                  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">'col'</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'patients'</span><span class="nt">&gt;&lt;/div&gt;</span>
                  <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
              <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>

...
</code></pre></div>
<blockquote>
<p>Add this HTML to <code class="prettyprint">index.html</code> immediately after the appointment-holder-row div. Should be on line 140.</p>

<p>/scheduling-app/src/js/scheduling-app.js - slotHTML</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript"><code><span class="p">...</span>

<span class="kd">function</span> <span class="nx">slotHTML</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Slot: id:['</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">'] type:['</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s1">'] start:['</span> <span class="o">+</span> <span class="nx">start</span> <span class="o">+</span> <span class="s1">'] end:['</span> <span class="o">+</span> <span class="nx">end</span> <span class="o">+</span> <span class="s1">']'</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">slotReference</span> <span class="o">=</span> <span class="s1">'Slot/'</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span>
      <span class="nx">prettyStart</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">start</span><span class="p">),</span>
      <span class="nx">prettyEnd</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">end</span><span class="p">);</span>

  <span class="k">return</span> <span class="s2">"&lt;div class='card'&gt;"</span> <span class="o">+</span>
           <span class="s2">"&lt;div class='card-body'&gt;"</span> <span class="o">+</span>
             <span class="s2">"&lt;h5 class='card-title'&gt;"</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s1">'&lt;/h5&gt;'</span> <span class="o">+</span>
             <span class="s2">"&lt;p class='card-text'&gt;Start: "</span> <span class="o">+</span> <span class="nx">prettyStart</span> <span class="o">+</span> <span class="s1">'&lt;/p&gt;'</span> <span class="o">+</span>
             <span class="s2">"&lt;p class='card-text'&gt;End: "</span> <span class="o">+</span> <span class="nx">prettyEnd</span> <span class="o">+</span> <span class="s1">'&lt;/p&gt;'</span> <span class="o">+</span>
             <span class="s2">"&lt;a href='javascript:void(0);' class='card-link' onclick='askForPatient(</span><span class="se">\"</span><span class="s2">"</span> <span class="o">+</span>
               <span class="nx">slotReference</span> <span class="o">+</span> <span class="s1">'", "'</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s1">'", "'</span> <span class="o">+</span> <span class="nx">prettyStart</span> <span class="o">+</span> <span class="s1">'", "'</span> <span class="o">+</span> <span class="nx">prettyEnd</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">);'&gt;Book&lt;/a&gt;"</span> <span class="o">+</span>
           <span class="s1">'&lt;/div&gt;'</span> <span class="o">+</span>
         <span class="s1">'&lt;/div&gt;'</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>
<blockquote>
<p>Replace the slotHTML JavaScript function with this JavaScript. Should be on line 58.</p>

<p>/scheduling-app/src/js/scheduling-app.js - clearUI</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript"><code><span class="p">...</span>

<span class="kd">function</span> <span class="nx">clearUI</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#errors'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#errors-row'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#loading-row'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#slots'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#slots-holder-row'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#appointment'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#appointment-holder-row'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-search-create-row'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
  <span class="nx">clearPatientUI</span><span class="p">();</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>
<blockquote>
<p>Replace the clearUI JavaScript function with this JavaScript. Should be on line 82.</p>

<p>/scheduling-app/src/js/scheduling-app.js</p>
</blockquote>
<div class="highlight"><pre class="highlight javascript"><code><span class="p">...</span>

<span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-search-form'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'submit'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="nx">patientSearch</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-create-form'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'submit'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="nx">patientCreate</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">$</span><span class="p">(</span><span class="s1">'#clear-patients'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patients'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patients-holder-row'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">askForPatient</span><span class="p">(</span><span class="nx">slotReference</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">clearUI</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-search-create-row'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>

  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-search-create-info'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span>
    <span class="s1">'&lt;p&gt;To book Appointment ['</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s1">'] on '</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">start</span><span class="p">).</span><span class="nx">toLocaleDateString</span><span class="p">()</span> <span class="o">+</span>
    <span class="s1">' at '</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">start</span><span class="p">).</span><span class="nx">toLocaleTimeString</span><span class="p">()</span> <span class="o">+</span> <span class="s1">' - '</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">end</span><span class="p">).</span><span class="nx">toLocaleTimeString</span><span class="p">()</span> <span class="o">+</span>
    <span class="s1">', select a Patient.&lt;/p&gt;'</span>
  <span class="p">);</span>
  <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'slotReference'</span><span class="p">,</span> <span class="nx">slotReference</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">patientSearch</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">clearPatientUI</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-loading-row'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>

  <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'patient-search-form'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">patientParams</span> <span class="o">=</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">};</span>

  <span class="nx">FHIR</span><span class="p">.</span><span class="nx">oauth2</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">smart</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">smart</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">fetchAll</span><span class="p">({</span><span class="na">type</span><span class="p">:</span> <span class="s1">'Patient'</span><span class="p">,</span> <span class="na">query</span><span class="p">:</span> <span class="nx">patientParams</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span>

      <span class="c1">// Display Patient information if the call succeeded</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">patients</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// If any Patients matched the criteria, display them</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">patients</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">patientsHTML</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span>
              <span class="nx">slotReference</span> <span class="o">=</span> <span class="nx">sessionStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'slotReference'</span><span class="p">);</span>

          <span class="nx">patients</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">patient</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">patientName</span> <span class="o">=</span> <span class="nx">patient</span><span class="p">.</span><span class="nx">name</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">given</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="nx">patient</span><span class="p">.</span><span class="nx">name</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">family</span><span class="p">;</span>
            <span class="nx">patientsHTML</span> <span class="o">=</span> <span class="nx">patientsHTML</span> <span class="o">+</span> <span class="nx">patientHTML</span><span class="p">(</span><span class="nx">slotReference</span><span class="p">,</span> <span class="nx">patient</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">patientName</span><span class="p">);</span>
          <span class="p">});</span>

          <span class="nx">form</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
          <span class="nx">renderPatients</span><span class="p">(</span><span class="nx">patientsHTML</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// If no Patients matched the criteria, inform the user</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">renderPatients</span><span class="p">(</span><span class="s1">'&lt;p&gt;No Patients found for the selected query parameters.&lt;/p&gt;'</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="c1">// Display 'Failed to read Patients from FHIR server' if the call failed</span>
      <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">clearPatientUI</span><span class="p">();</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-errors'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'&lt;p&gt;Failed to read Patients from FHIR server&lt;/p&gt;'</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-errors-row'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">patientHTML</span><span class="p">(</span><span class="nx">slotReference</span><span class="p">,</span> <span class="nx">patientId</span><span class="p">,</span> <span class="nx">patientName</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Patient: name:['</span> <span class="o">+</span> <span class="nx">patientName</span> <span class="o">+</span> <span class="s1">']'</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">patientReference</span> <span class="o">=</span> <span class="s1">'Patient/'</span> <span class="o">+</span> <span class="nx">patientId</span><span class="p">;</span>

  <span class="k">return</span> <span class="s2">"&lt;div class='card'&gt;"</span> <span class="o">+</span>
           <span class="s2">"&lt;div class='card-body'&gt;"</span> <span class="o">+</span>
             <span class="s2">"&lt;h5 class='card-title'&gt;"</span> <span class="o">+</span> <span class="nx">patientName</span> <span class="o">+</span> <span class="s1">'&lt;/h5&gt;'</span> <span class="o">+</span>
             <span class="s2">"&lt;a href='javascript:void(0);' class='card-link' onclick='appointmentCreate(</span><span class="se">\"</span><span class="s2">"</span> <span class="o">+</span>
               <span class="nx">slotReference</span> <span class="o">+</span> <span class="s1">'", "'</span> <span class="o">+</span> <span class="nx">patientReference</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">);'&gt;Use Patient&lt;/a&gt;"</span> <span class="o">+</span>
           <span class="s1">'&lt;/div&gt;'</span> <span class="o">+</span>
         <span class="s1">'&lt;/div&gt;'</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">patientCreate</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">clearPatientUI</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-loading-row'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>

  <span class="c1">// Grab Patient POST body attributes from the patient-create-form</span>
  <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'patient-create-form'</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">patientBody</span> <span class="o">=</span> <span class="nx">patientJSON</span><span class="p">(</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="s1">'patient-create-firstname'</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="s1">'patient-create-middlename'</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="s1">'patient-create-lastname'</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="s1">'patient-create-phone'</span><span class="p">].</span><span class="nx">value</span><span class="p">,</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="s1">'patient-create-male'</span><span class="p">].</span><span class="nx">checked</span> <span class="p">?</span> <span class="s1">'male'</span> <span class="p">:</span> <span class="s1">'female'</span><span class="p">,</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">elements</span><span class="p">[</span><span class="s1">'patient-create-birthdate'</span><span class="p">].</span><span class="nx">value</span>
  <span class="p">);</span>

  <span class="c1">// FHIR.oauth2.ready handles refreshing access tokens</span>
  <span class="nx">FHIR</span><span class="p">.</span><span class="nx">oauth2</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">smart</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">smart</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="na">resource</span><span class="p">:</span> <span class="nx">patientBody</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span>

      <span class="c1">// Display Patient information if the call succeeded</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">patient</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-loading-row'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">form</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">'Created Patient '</span> <span class="o">+</span> <span class="nx">patient</span><span class="p">.</span><span class="nx">headers</span><span class="p">(</span><span class="s1">'Location'</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/</span><span class="se">\d</span><span class="sr">+$/</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">'</span><span class="err">\</span><span class="s1">n</span><span class="err">\</span><span class="s1">nSearch for them by name.'</span><span class="p">);</span>
      <span class="p">},</span>

      <span class="c1">// Display 'Failed to write Patient to FHIR server' if the call failed</span>
      <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-loading-row'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">'Failed to write Patient to FHIR server'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">patientJSON</span><span class="p">(</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">middleName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">,</span> <span class="nx">phone</span><span class="p">,</span> <span class="nx">gender</span><span class="p">,</span> <span class="nx">birthDate</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">periodStart</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">resourceType</span><span class="p">:</span> <span class="s1">'Patient'</span><span class="p">,</span>
    <span class="na">identifier</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">assigner</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">reference</span><span class="p">:</span> <span class="s1">'Organization/619848'</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="na">active</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">use</span><span class="p">:</span> <span class="s1">'official'</span><span class="p">,</span>
        <span class="na">family</span><span class="p">:</span> <span class="p">[</span>
          <span class="nx">lastName</span>
        <span class="p">],</span>
        <span class="na">given</span><span class="p">:</span> <span class="p">[</span>
          <span class="nx">firstName</span><span class="p">,</span>
          <span class="nx">middleName</span>
        <span class="p">],</span>
        <span class="na">period</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">start</span><span class="p">:</span> <span class="nx">periodStart</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="na">telecom</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">system</span><span class="p">:</span> <span class="s1">'phone'</span><span class="p">,</span>
        <span class="na">value</span><span class="p">:</span> <span class="nx">phone</span><span class="p">,</span>
        <span class="na">use</span><span class="p">:</span> <span class="s1">'home'</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="na">gender</span><span class="p">:</span> <span class="nx">gender</span><span class="p">,</span>
    <span class="na">birthDate</span><span class="p">:</span> <span class="nx">birthDate</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">renderPatients</span><span class="p">(</span><span class="nx">patientsHTML</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">clearPatientUI</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patients'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">patientsHTML</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patients-holder-row'</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">clearPatientUI</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-errors'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-errors-row'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patient-loading-row'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patients'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#patients-holder-row'</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<p>Add this JavaScript to the bottom of <code class="prettyprint">scheduling-app.js</code>.</p>
</blockquote>

<p>In the previous step, all Appointments were booked for a single test patient. Let&rsquo;s add functionality to our app that searches for different Patients or even registers new Patients.</p>

<p>After redeploying your app, upon selecting an Appointment to book a dialog will be presented that allows you to search for Patients by name or register your own test patient. Go ahead and try both options. Any patients you create here will be available for other developers to use in Cerner&rsquo;s Sandbox!</p>

<h1 id="summary">Summary</h1>

<p>Through this tutorial we have:</p>

<ul>
<li>Created a basic SMART on FHIR app.</li>
<li>Registered that app with Cerner.</li>
<li>Run the app in Cerner&rsquo;s SMART on FHIR sandbox.</li>
</ul>

<p>We&rsquo;ve created a very basic application that meets the base requirements of being a SMART app. This application would require a fair amount of polish before being ready to be deployed in a production environment. A couple of next steps you could look at are:</p>

<ul>
<li>Try adding more scheduling resources like Schedule to your workflow. You may want to do this by relaxing the requirement to search for Slots by Practitioner, and follow each Slot&rsquo;s Schedule reference to show its Practitioner to your user.</li>
<li>Write unit tests for the application.</li>
<li>Localize and Internationalize your application.</li>
</ul>

<p>We&rsquo;re excited to see what you&rsquo;ll build next!</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="code">code</a>
          </div>
      </div>
    </div>
  </body>
</html>
